<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Order Status</title>
    <link rel="shortcut icon" type="image/png" href="../assets/images/logos/favicon.png" />
    <link rel="stylesheet" href="../assets/css/styles.min.css" />

    <style>
        /* Style the select element */
        .custom-select {
            position: relative;
            width: 100%;
        }

        /* Hide the default arrow */
        .custom-select select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background: transparent;
            padding-right: 1em;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.7em top 50%;
            background-size: 1.5em auto;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 1em;
            line-height: 2;
            padding: 0.280rem 1.75rem 0.280rem 0.75rem;
            -webkit-transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
    </style>

    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>

    <style>
        * {
            box-sizing: border-box
        }

        /* Slideshow container */
        .slideshow-container {
            max-width: 1000px;
            position: relative;
            margin: auto;
        }

        /* Hide the images by default */
        .mySlides {
            display: none;
        }

        /* Next & previous buttons */
        .prev,
        .next {
            cursor: pointer;
            position: absolute;
            top: 50%;
            width: auto;
            margin-top: -22px;
            padding: 16px;
            color: white;
            font-weight: bold;
            font-size: 18px;
            transition: 0.6s ease;
            border-radius: 0 3px 3px 0;
            user-select: none;
        }

        /* Position the "next button" to the right */
        .next {
            right: 0;
            border-radius: 3px 0 0 3px;
        }

        /* On hover, add a black background color with a little bit see-through */
        .prev:hover,
        .next:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }

        /* Caption text */
        .text {
            color: #f2f2f2;
            font-size: 15px;
            padding: 8px 12px;
            position: absolute;
            bottom: 8px;
            width: 100%;
            text-align: center;
        }

        /* Number text (1/3 etc) */
        .numbertext {
            color: #f2f2f2;
            font-size: 12px;
            padding: 8px 12px;
            position: absolute;
            top: 0;
        }

        /* The dots/bullets/indicators */
        .dot {
            cursor: pointer;
            height: 15px;
            width: 15px;
            margin: 0 2px;
            background-color: #bbb;
            border-radius: 50%;
            display: inline-block;
            transition: background-color 0.6s ease;
        }

        .active,
        .dot:hover {
            background-color: #717171;
        }

        /* Fading animation */
        .fade {
            animation-name: fade;
            animation-duration: 2s;
        }

        @keyframes fade {
            from {
                opacity: .2
            }

            to {
                opacity: 1
            }
        }
    </style>

</head>

<body>
    <!--  Body Wrapper -->
    <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
        data-sidebar-position="fixed" data-header-position="fixed">
        <!-- Sidebar Start -->
        <aside class="left-sidebar">
            <!-- Sidebar scroll-->
            <div>
                <div class="brand-logo d-flex align-items-center justify-content-between">
                    <a href="./products.html" class="text-nowrap logo-img">
                        <img src="../assets/images/logos/favicon.png" width="180" alt="" />
                    </a>
                    <div class="close-btn d-xl-none d-block sidebartoggler cursor-pointer" id="sidebarCollapse">
                        <i class="ti ti-x fs-8"></i>
                    </div>
                </div>
                <!-- Sidebar navigation-->
                <nav class="sidebar-nav scroll-sidebar" data-simplebar="">
                    <ul id="sidebarnav">
                        <li class="nav-small-cap">
                            <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
                            <span class="hide-menu">Home</span>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./products.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-layout-dashboard"></i>
                                </span>
                                <span class="hide-menu">Products</span>
                            </a>
                        </li>
                        <li class="nav-small-cap">
                            <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
                            <span class="hide-menu">Menu</span>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./profile.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-article"></i>
                                </span>
                                <span class="hide-menu">Profile</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./orders.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-alert-circle"></i>
                                </span>
                                <span class="hide-menu">Orders</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./feedback.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-cards"></i>
                                </span>
                                <span class="hide-menu">Feedback</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./ratings.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-file-description"></i>
                                </span>
                                <span class="hide-menu">Ratings</span>
                            </a>
                        </li>

                        <li class="nav-small-cap">
                            <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
                            <span class="hide-menu">Settings</span>
                        </li>

                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./change-logo.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-file-description"></i>
                                </span>
                                <span class="hide-menu">Settings</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./add-offer.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-file-description"></i>
                                </span>
                                <span class="hide-menu">Offers</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./login.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-login"></i>
                                </span>
                                <span class="hide-menu">Logout</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                <!-- End Sidebar navigation -->
            </div>
            <!-- End Sidebar scroll-->
        </aside>
        <!--  Sidebar End -->
        <!--  Main wrapper -->
        <div class="body-wrapper">
            <div>
                <div class="card">
                    <div class="card-body">
                        <h2 style="width: 100%; text-align: center;">Order Status</h2>
                        <div class="card" style="width: 75%; margin-left: 9%;">
                            <div class="card-body">
                                <!--Form Starting Here-->
                                <form id="orderForm">
                                    <div class="row">
                                        <div class="col-sm-8">
                                            <div class="row">
                                                <div class="col-sm-8" style="margin-top: 20px;">

                                                    <table>
                                                        <tr>
                                                            <th>Order ID</th>
                                                            <td id="order">ER15960R6M4JJJ</td>
                                                        </tr>
                                                        <tr>
                                                            <th>Date</th>
                                                            <td id="date">16.02.2024</td>
                                                        </tr>
                                                        <tr>
                                                            <th>Product Name</th>
                                                            <td id="name">I Watch Ultra</td>
                                                        </tr>
                                                        <tr>
                                                            <th>Shipping</th>
                                                            <td id="shipping">100.00</td>
                                                        </tr>
                                                        <tr>
                                                            <th>Product ID</th>
                                                            <td id="product">ET5578</td>
                                                        </tr>

                                                    </table>

                                                    <h5 style="margin-top: 20px;">Change Order Status</h5>
                                                    <div class="custom-select">
                                                        <select class="form-control" id="orderstatus">
                                                            <option value="1">Ordered</option>
                                                            <option value="2">Dispatched</option>
                                                            <option value="3">Out For Delivery</option>
                                                            <option value="4">Delivered</option>
                                                            <option value="5">Returned</option>
                                                        </select>
                                                    </div>

                                                    <div style="margin-top: 20px;">
                                                        <h5>Remarks</h5>
                                                        <textarea class="form-control" id="remarks"
                                                            style="min-height: 60px;"
                                                            placeholder="Enter your Remarks"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4 center">

                                            <div class="mySlides">
                                                <div class="numbertext" style="height: 250px; width: 250px;">1 / 6
                                                </div>
                                                <img style="margin-left: auto;
                                                    margin-right: auto;width: 250px;"
                                                    src="../assets/images/profile/images.jpeg" height="250px"
                                                    id="img1" />

                                            </div>

                                            <div class="mySlides">
                                                <div class="numbertext" style="height: 250px; width: 250px;">2 / 6
                                                </div>
                                                <img style="margin-left: auto;
                                                    margin-right: auto; width: 250px;"
                                                    src="../assets/images/profile/watch.png" height="250px" id="img2" />

                                            </div>

                                            <div class="mySlides">
                                                <div class="numbertext" style="height: 250px; width: 250px;">3 / 6
                                                </div>
                                                <img style="margin-left: auto;
                                                    margin-right: auto; width: 250px;"
                                                    src="../assets/images/profile/iwatch.jpg" height="250px"
                                                    id="img3" />

                                            </div>

                                            <div class="mySlides">
                                                <div class="numbertext" style="height: 250px; width: 250px;">4 / 6
                                                </div>
                                                <img style="margin-left: auto;
                                                    margin-right: auto; width: 250px;"
                                                    src="../assets/images/profile/sample.png" height="250px"
                                                    id="img4" />

                                            </div>

                                            <div class="mySlides">
                                                <div class="numbertext" style="height: 250px; width: 250px;">5 / 6
                                                </div>
                                                <img style="margin-left: auto;
                                                    margin-right: auto; width: 250px;"
                                                    src="../assets/images/profile/watch.jpg" height="250px" id="img5" />

                                            </div>

                                            <div class="mySlides">
                                                <div class="numbertext" style="height: 250px; width: 250px;">6 / 6
                                                </div>
                                                <img style="margin-left: auto;
                                                    margin-right: auto; width: 250px;"
                                                    src="../assets/images/profile/side.webp" height="250px" id="img6" />

                                            </div>

                                            <!-- Next and previous buttons -->
                                            <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                                            <a class="next" onclick="plusSlides(1)">&#10095;</a>

                                            <br>

                                            <!-- The dots/circles -->
                                            <div style="text-align:center">
                                                <span class="dot" onclick="currentSlide(1)"></span>
                                                <span class="dot" onclick="currentSlide(2)"></span>
                                                <span class="dot" onclick="currentSlide(3)"></span>
                                                <span class="dot" onclick="currentSlide(4)"></span>
                                                <span class="dot" onclick="currentSlide(5)"></span>
                                                <span class="dot" onclick="currentSlide(6)"></span>
                                            </div>
                                        </div>



                                        <div style="display: flex;">
                                            <button type="button" class="btn btn-primary"
                                                style="margin-top: 20px; margin-left: 380px;" onclick="redirect()">
                                                Cancel
                                            </button>
                                            <button type="button" class="btn btn-primary"
                                                style="margin-top: 20px; margin-left: 10px;" onclick="updateOrder()">
                                                Update
                                            </button>
                                        </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let slideIndex = 1;
        showSlides(slideIndex);

        function plusSlides(n) {
            showSlides(slideIndex += n);
        }

        function currentSlide(n) {
            showSlides(slideIndex = n);
        }

        function showSlides(n) {
            let i;
            let slides = document.getElementsByClassName("mySlides");
            let dots = document.getElementsByClassName("dot");
            if (n > slides.length) { slideIndex = 1; }
            if (n < 1) { slideIndex = slides.length; }
            for (i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";
            }
            for (i = 0; i < dots.length; i++) {
                dots[i].className = dots[i].className.replace(" active", "");
            }
            slides[slideIndex - 1].style.display = "block";
            dots[slideIndex - 1].className += " active";
        }
    </script>

    <script>
        // const getOrderDetails = () => {
        //     const url = "../api/get-orders-web.php";
        //     const body = JSON.stringify({
        //         token: window.localStorage.getItem("authToken"),
        //     });
        //     fetch(url, {
        //         method: "POST",
        //         body: body,
        //         headers: {
        //             "Content-Type": "application/json",
        //             Accept: "application/json",
        //         },
        //     })
        //         .then((res) => res.json())
        //         .then((data) => {
        //             if (data.success) {
        //                 data.data.forEach(element => {
        //                     if (element.order_id == window.localStorage.getItem("orderId")) {

        //                         let status = 1
        //                         if (element.status == "Dispatched") {
        //                             status = 2
        //                         }
        //                         if (element.status == "Out for Delivery") {
        //                             status = 3
        //                         }
        //                         if (element.status == "Delivered") {
        //                             status = 4
        //                         }
        //                         if (element.status == "Returned") {
        //                             status = 5
        //                         }
        //                         document.getElementById("order").innerHTML = "ASCARC00" + element.order_id
        //                         document.getElementById("date").innerHTML = element.ordered_at
        //                         document.getElementById("name").innerHTML = element.productDetails[0].watchDetails.name + "-" + element.productDetails[0].watchDetails.model
        //                         document.getElementById("shipping").innerHTML = parseFloat(element.price).toFixed(2)
        //                         document.getElementById("orderstatus").value = status
        //                         document.getElementById("product").innerHTML = element.productDetails[0].watchDetails.item_code

        //                     }
        //                 });

        //             }
        //             else {
        //                 alert(data.msg)
        //             }

        //         })
        // }
        // getOrderDetails()

        const getOrderDetails = () => {
            const url = "../api/get-orders-web.php";
            const body = JSON.stringify({
                token: window.localStorage.getItem("authToken"),
            });
            fetch(url, {
                method: "POST",
                body: body,
                headers: {
                    "Content-Type": "application/json",
                    Accept: "application/json",
                },
            })
                .then((res) => res.json())
                .then((data) => {
                    if (data.success) {
                        const orderId = window.localStorage.getItem("orderId");
                        const order = data.data.find(element => element.order_id == orderId);
                        if (order) {
                            let status = 1;
                            switch (order.status) {
                                case "Dispatched":
                                    status = 2;
                                    break;
                                case "Out for Delivery":
                                    status = 3;
                                    break;
                                case "Delivered":
                                    status = 4;
                                    break;
                                case "Returned":
                                    status = 5;
                                    break;
                            }

                            const productDetails = order.productDetails[0] || {};
                            const watchDetails = productDetails.watchDetails || {};

                            document.getElementById("order").innerText = "ASCARC00" + order.order_id;
                            document.getElementById("date").innerText = new Date(order.ordered_at).toLocaleDateString();
                            document.getElementById("name").innerText = watchDetails.name + "-" + watchDetails.model;
                            document.getElementById("shipping").innerText = parseFloat(order.price[0]).toFixed(2);
                            document.getElementById("orderstatus").value = status;
                            document.getElementById("product").innerText = watchDetails.item_code;
                        } else {
                            alert("Order not found");
                        }
                    } else {
                        alert(data.msg);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        };

        getOrderDetails();





        function redirect() {
            window.location.href = "./orders.html";
        }


        // Function to handle form submission
        function updateOrder() {
            let orderstatus = document.getElementById("orderstatus").value;
            let remarks = document.getElementById("remarks").value;
            let orderid = document.getElementById("order").value;

            if (orderstatus == "1" && remarks == "") {
                alert("Please change the status");
            }
            else if (orderstatus != "1") {
                const url = "../api/update-order-status.php"; // Replace with your API endpoint and the resource ID
                const body = JSON.stringify({
                    orderId: window.localStorage.getItem("orderId"),
                    orderStatus: orderstatus,
                    remarks: remarks,
                    token: window.localStorage.getItem("authToken"),
                });

                fetch(url, {
                    method: "POST",
                    body: body,
                    headers: {
                        "Content-Type": "application/json",
                        Accept: "application/json",
                    },
                })
                    .then((res) => res.json())
                    .then((data) => {
                        if (data.success == true) {
                            alert(data.msg); {
                                if (data.success == true) {
                                    alert(data.msg);
                                    window.location.href = "./products.html"
                                }
                                else {
                                    alert(data.msg); // Show error message
                                }
                            }
                        }
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                        alert("An error occurred while updating the order status.");
                    });

            }
        }

        const getWatchImages = () => {
            const url = '../api/get-indi-watch.php';
            const body = JSON.stringify({
                wid: window.localStorage.getItem("wid"),
                token: window.localStorage.getItem("authToken")

            })
            fetch(url, {
                method: "POST",
                body: body,
                headers: {
                    "Content-Type": "application/json",
                    Accept: "application/json",
                },
            },
            ).then(response => {
                return response.json();
            }).then(data => {
                if (data.success) {
                    document.getElementById("img1").src = data.data[0].image_front;
                    document.getElementById("img2").src = data.data[0].image_right;
                    document.getElementById("img3").src = data.data[0].image_left;
                    document.getElementById("img4").src = data.data[0].image_back;
                    document.getElementById("img5").src = data.data[0].image_up;
                    document.getElementById("img6").src = data.data[0].image_down;
                }
                else {
                    alert(data.msg);
                }
            }).catch(err => {
                alert("error")
            });
        }

        getWatchImages();
    </script>
</body>

</html>